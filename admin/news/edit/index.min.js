const tbody=document.querySelector("tbody"),template=document.querySelector("template"),loadMoreBtn=document.querySelector("button[name=loadNews]"),form=document.querySelector("form");let newsArr,newsCounter=10;async function loadNews(){const e=await fetch(`./../../../news/get.php?n=${newsCounter}`),t=await e.json();if(t.disable_btn&&(loadMoreBtn.disabled=!0,loadMoreBtn.hidden=!0),t.error)return UIkit.notification({message:t.msg,status:t.status||"danger",timeout:5e3});tbody.innerHTML="",t.news.forEach(e=>{const t=template.content.cloneNode(!0);t.querySelector("[data-title]").href="/news/"+e.id,t.querySelector("[data-body]").href="/news/"+e.id,t.querySelector("[data-id]").textContent=e.id,t.querySelector("[data-title]").textContent=e.title,t.querySelector("[data-body]").innerHTML=e.body.replace(/(<([^>]+)>)/gi," ").substr(0,30)+"...",t.querySelector("[data-added_at]").textContent=e.added_at,t.querySelector("[data-author]").textContent=e.author,t.querySelector("[data-edit]").dataset.id=e.id,t.querySelector("tr").ondblclick=(t=>openEditModal(e.id)),t.querySelector("[data-edit]").onclick=(t=>openEditModal(e.id)),tbody.append(t)}),newsArr=t.news,$(".tablesorter").trigger("update")}function openEditModal(e){const t=getNewsById(e);document.querySelector("input[name=id]").value=e,document.querySelector("input[name=added_at]").value=t.added_at,document.querySelector("input[name=author]").value=t.author,document.querySelector("input[name=title]").value=t.title,editor.setData(t.body),UIkit.modal("#modal").show()}async function deleteNews(e){const t=new FormData;t.append("id",e);const o=await fetch("./../delete.php",{method:"POST",body:t}),a=await o.json();UIkit.notification({message:a.msg,status:a.status||"danger",timeout:5e3}),a.error||loadNews()}function getNewsById(e){return newsArr.find(t=>t.id==e)}loadNews(),loadMoreBtn.onclick=(()=>{newsCounter+=10,loadNews()}),form.onsubmit=(async e=>{e.preventDefault();const t=document.querySelector("input[name=id]"),o=document.querySelector("input[name=title]"),a=editor.getData();if(!(o.value.length&&t.value.length&&a.length))return UIkit.notification({message:"Uzupe≈Çnij wszystkie pola!",status:"danger",timeout:5e3});const n=new FormData;n.append("id",t.value),n.append("title",o.value),n.append("body",a);const d=await fetch("./../edit.php",{method:"POST",body:n}),r=await d.json();UIkit.notification({message:r.msg,status:r.status||"danger",timeout:5e3}),r.error||(loadNews(),UIkit.modal("#modal").hide())});