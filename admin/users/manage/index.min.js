getUsers();const tbody=document.querySelector("tbody"),template=document.querySelector("template"),form=document.querySelector("form");async function getUsers(){const e=await fetch("./../../scripts/get-users.php");(await e.json()).users.forEach(e=>{const t=template.content.cloneNode(!0);e.birthdate=new Date(e.birthdate),e.last_time_online=new Date(e.last_time_online),t.querySelector("tr").dataset.row_id=e.id,t.querySelector("[data-id]").textContent=e.id,t.querySelector("[data-picture]").src=PROFILE_PICTURES_PATH+e.picture,t.querySelector("[data-picture_name]").textContent=e.picture,t.querySelector("[data-name]").textContent=e.name,t.querySelector("[data-last_name]").textContent=e.last_name,t.querySelector("[data-role]").textContent=e.role,t.querySelector("[data-birthdate]").textContent=formatDate(e.birthdate),t.querySelector("[data-username]").textContent=e.username,t.querySelector("[data-email]").textContent=e.email,t.querySelector("[data-phone_no]").textContent=e.phone_no.match(/.{1,3}/g).join("-"),t.querySelector("[data-admin]").textContent=e.admin?"TAK":"NIE",t.querySelector("[data-online]").textContent=formatDate(e.last_time_online)+" "+formatTime(e.last_time_online),t.querySelector("[data-edit]").dataset.id=e.id,t.querySelector("tr").ondblclick=(e=>openEditModal(e.target.parentNode.dataset.row_id)),t.querySelector("[data-edit]").onclick=(e=>openEditModal(e.target.dataset.id)),tbody.append(t)}),$(".tablesorter").trigger("update")}function openEditModal(e){const t=document.querySelector(`[data-row_id="${e}"]`);document.querySelector("input[name=id]").value=e,document.querySelector("input[name=birthdate]").value=formatDateBack(t.querySelector("[data-birthdate]").textContent),document.querySelector("input[name=name]").value=t.querySelector("[data-name]").textContent,document.querySelector("input[name=last_name]").value=t.querySelector("[data-last_name]").textContent,document.querySelector("select[name=role]").value=t.querySelector("[data-role]").textContent,document.querySelector("input[name=username]").value=t.querySelector("[data-username]").textContent,document.querySelector("input[name=email]").value=t.querySelector("[data-email]").textContent,document.querySelector("input[name=phone_no]").value=t.querySelector("[data-phone_no]").textContent.split("-").join(""),document.querySelector("input[name=admin]").checked="TAK"==t.querySelector("[data-admin]").textContent,document.querySelector("input[name=online]").value=t.querySelector("[data-online]").textContent,form.querySelector("img").src=PROFILE_PICTURES_PATH+t.querySelector("[data-picture_name]").textContent,form.querySelector("label").hidden=t.querySelector("[data-picture_name]").textContent===DEFAULT_PROFILE_PICTURE_NAME,UIkit.modal("#modal").show()}function formatDate(e){let t=e.getDate(),a=e.getMonth()+1;return`${t=t<10?`0${t}`:t}-${a=a<10?`0${a}`:a}-${e.getFullYear()}`}function formatDateBack(e){return`${e.substr(6,4)}-${e.substr(3,2)}-${e.substr(0,2)}`}function formatTime(e){let t=e.getMinutes();return`${e.getHours()}:${t<10?"0"+t:t}`}form.onsubmit=(async e=>{e.preventDefault();const t=document.querySelectorAll("input");let a=!1;if(t.forEach(e=>{e.value.length?e.classList.remove("uk-form-danger"):(e.classList.add("uk-form-danger"),a=!0)}),a)return UIkit.notification({message:"Uzupe≈Çnij wszystkie pola!",status:"danger",timeout:5e3});const n=new FormData;n.append("id",form.querySelector("input[name=id]").value),n.append("name",form.querySelector("input[name=name]").value),n.append("last_name",form.querySelector("input[name=last_name]").value),n.append("birthdate",form.querySelector("input[name=birthdate]").value),n.append("username",form.querySelector("input[name=username]").value),n.append("email",form.querySelector("input[name=email]").value),n.append("phone_no",form.querySelector("input[name=phone_no]").value),n.append("role",form.querySelector("select[name=role]").value),n.append("admin",form.querySelector("input[name=admin]").checked),n.append("delete-picture",form.querySelector("input[name=delete-picture]").checked);const r=await fetch("./../../scripts/update-user.php",{method:"POST",body:n}),o=await r.json();if(UIkit.notification({message:o.msg,status:o.status||"danger",timeout:5e3}),o.error)return;UIkit.modal("#modal").hide();const u=document.querySelector(`[data-row_id="${n.get("id")}"]`);u.querySelector("[data-birthdate]").textContent=formatDate(new Date(n.get("birthdate"))),u.querySelector("[data-name]").textContent=n.get("name"),u.querySelector("[data-last_name]").textContent=n.get("last_name"),u.querySelector("[data-role]").textContent=n.get("role"),u.querySelector("[data-username]").textContent=n.get("username"),u.querySelector("[data-email]").textContent=n.get("email"),u.querySelector("[data-phone_no]").textContent=n.get("phone_no").match(/.{1,3}/g).join("-"),u.querySelector("[data-admin]").textContent="true"==n.get("admin")?"TAK":"NIE","true"==n.get("delete-picture")&&(u.querySelector("[data-picture_name]").textContent=DEFAULT_PROFILE_PICTURE_NAME,u.querySelector("[data-picture]").src=PROFILE_PICTURES_PATH+u.querySelector("[data-picture_name]").textContent),$(".tablesorter").trigger("update")});