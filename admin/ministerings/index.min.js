const tbody=document.querySelector("tbody"),template=document.querySelector("template");let table=[];function openEditModal(e){const t=getUserById(e);document.querySelector("input[name=id]").value=e,document.querySelector("input[name=name]").value=t.name,document.querySelector("input[name=last_name]").value=t.last_name,document.querySelector("input[name=role]").value=t.role.capitalize();let o=1;t.ministerings.forEach(e=>{document.querySelector(`select[name=day_of_week${o}]`).value=e.day_of_week,document.querySelector(`input[name=hour${o}]`).value=e.hour.length<5?"0"+e.hour:e.hour,document.querySelector(`input[name=row_id${o}]`).value=e.row_id,++o});for(let e=o;e<=3;++e)document.querySelector(`select[name=day_of_week${e}]`).value=null,document.querySelector(`input[name=hour${e}]`).value="",document.querySelector(`input[name=row_id${e}]`).value="0";UIkit.modal("#modal").show()}function renderTable(e){tbody.innerHTML="",e.forEach(e=>{const t=template.content.cloneNode(!0);t.querySelector("[data-id]").textContent=e.id,t.querySelector("[data-picture]").src=PROFILE_PICTURES_PATH+e.picture,t.querySelector("[data-name]").textContent=e.name,t.querySelector("[data-last_name]").textContent=e.last_name,t.querySelector("[data-role]").textContent=e.role,t.querySelector("tr").ondblclick=(t=>openEditModal(e.id)),t.querySelector("[data-edit]").onclick=(t=>openEditModal(e.id)),e.ministerings.forEach(e=>{t.querySelector("[data-ministerings]").innerHTML+=getDayOfWeekName(e.day_of_week)+", "+e.hour+"<br>"}),e.ministerings.length||(t.querySelector("[data-ministerings]").innerHTML="brak"),tbody.append(t)}),$(".tablesorter").trigger("update")}function getDayOfWeekName(e){return arr=["Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota","Niedziela"],arr[e-1]}function getUserById(e){return table.find(t=>t.id==e)}async function loadData(){const e=await fetch("./getData.php"),t=await e.json();table=t,renderTable(t)}loadData(),document.querySelector("form").onsubmit=(e=>{e.preventDefault();const t=document.querySelector("input[name=id]").value;let o=[{day_of_week:document.querySelector("select[name=day_of_week1]").value,hour:document.querySelector("input[name=hour1]").value,row_id:document.querySelector("input[name=row_id1]").value},{day_of_week:document.querySelector("select[name=day_of_week2]").value,hour:document.querySelector("input[name=hour2]").value,row_id:document.querySelector("input[name=row_id2]").value},{day_of_week:document.querySelector("select[name=day_of_week3]").value,hour:document.querySelector("input[name=hour3]").value,row_id:document.querySelector("input[name=row_id3]").value}],a=!0;o.forEach(async e=>{if("0"==e.hour.substr(0,1)&&(e.hour=e.hour.slice(1)),"delete"===e.day_of_week){const t=new FormData;t.append("row_id",e.row_id);const o=await fetch("./delete.php",{method:"POST",body:t});(await o.json()).error&&(a=!1)}else if("null"!=e.day_of_week&&e.hour.length){const o=new FormData;o.append("uid",t),o.append("row_id",e.row_id),o.append("day_of_week",e.day_of_week),o.append("hour",e.hour);const r=await fetch("./add.php",{method:"POST",body:o});(await r.json()).error&&(a=!1)}}),loadData(),a?(UIkit.notification({message:"Zapisano zmiany!",status:"success",timeout:5e3}),UIkit.modal("#modal").hide()):UIkit.notification({message:"database error",status:"danger",timeout:5e3})}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};