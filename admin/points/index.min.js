loadRecords((new Date).getMonth()+1,(new Date).getFullYear());const tbody=document.querySelector("tbody"),template=document.querySelector("template");function savePoints(){let e=!0;const t=new FormData;tbody.querySelectorAll("tr").forEach(async n=>{if(!isNumeric(n.querySelector("input[name=points_plus]").value)||!isNumeric(n.querySelector("input[name=points_minus]").value))return;t.append("uid",n.querySelector("td[data-id]").textContent),t.append("month",document.querySelector("select[name=month]").value),t.append("year",document.querySelector("select[name=year]").value),t.append("points_plus",n.querySelector("input[name=points_plus]").value),t.append("points_minus",n.querySelector("input[name=points_minus]").value);const o=await fetch("./updatePoints.php",{method:"POST",body:t});(await o.json()).error&&(e=!1)}),e?UIkit.notification({message:"Zapisano zmiany!",status:"success",timeout:5e3}):UIkit.notification({message:"database error",status:"danger",timeout:5e3})}async function loadRecords(e,t){const n=await fetch(`./getData.php?month=${e}&year=${t}`),o=await n.json();if(o.error)return UIkit.notification({message:o.msg,status:o.status||"danger",timeout:5e3});tbody.innerHTML="",o.points.forEach(e=>{const t=template.content.cloneNode(!0);t.querySelector("[data-id]").textContent=e.id,t.querySelector("[data-name]").textContent=e.name,t.querySelector("[data-last_name]").textContent=e.last_name,t.querySelector("[data-role]").textContent=e.role,t.querySelector("[data-points_plus]").querySelector("input").value=e.points_plus,t.querySelector("[data-points_minus]").querySelector("input").value=e.points_minus,tbody.append(t)}),$(".tablesorter").trigger("update")}function isNumeric(e){return/^\d+$/.test(e)}document.querySelectorAll("select").forEach(e=>{e.oninput=(()=>{loadRecords(document.querySelector("select[name=month]").value,document.querySelector("select[name=year]").value)})});