loadRecords((new Date).getMonth()+1,(new Date).getFullYear());const tbody=document.querySelector("tbody"),template=document.querySelector("template");function savePoints(){let e=!0;const t=new FormData;tbody.querySelectorAll("tr").forEach(async o=>{t.append("uid",o.querySelector("td[data-id]").textContent),t.append("row_id",o.querySelector("td[data-row_id]").textContent),t.append("month",o.querySelector("td[data-month]").textContent),t.append("year",o.querySelector("td[data-year]").textContent),t.append("points_plus",o.querySelector("input[name=points_plus]").value),t.append("points_minus",o.querySelector("input[name=points_minus]").value);const a=await fetch("./updatePoints.php",{method:"POST",body:t});(await a.json()).error&&(e=!1)}),e?UIkit.notification({message:"Zapisano zmiany!",status:"success",timeout:5e3}):UIkit.notification({message:"database error",status:"danger",timeout:5e3})}async function loadRecords(e,t){const o=await fetch(`./getData.php?month=${e}&year=${t}`),a=await o.json();if(a.error)return UIkit.notification({message:a.msg,status:a.status||"danger",timeout:5e3});tbody.innerHTML="",a.points.forEach(o=>{const a=template.content.cloneNode(!0);a.querySelector("[data-id]").textContent=o.id,a.querySelector("[data-row_id]").textContent=o.row_id,a.querySelector("[data-name]").textContent=o.name,a.querySelector("[data-last_name]").textContent=o.last_name,a.querySelector("[data-role]").textContent=o.role,a.querySelector("[data-month]").textContent=e,a.querySelector("[data-year]").textContent=t,a.querySelector("[data-points_plus]").querySelector("input").value=o.points_plus,a.querySelector("[data-points_minus]").querySelector("input").value=o.points_minus,tbody.append(a)}),$(".tablesorter").trigger("update")}document.querySelectorAll("select").forEach(e=>{e.oninput=(()=>{loadRecords(document.querySelector("select[name=month]").value,document.querySelector("select[name=year]").value)})});